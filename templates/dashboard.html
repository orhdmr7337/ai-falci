{% extends "base.html" %}

{% block content %}
<div class="cosmic-container">
    <div class="dashboard-header fortune-card">
        <div class="profile-avatar">
            {% if user.profile.zodiac_sign %}
            <div class="zodiac-symbol">{{ user.profile.zodiac_sign }}</div>
            {% else %}
            <div class="zodiac-symbol">âœ¨</div>
            {% endif %}
        </div>
        <h2>HoÅŸ Geldin, {{ user.username }}</h2>
        <p class="cosmic-quote">âœ§ GÃ¼nlÃ¼k fal haklarÄ±nÄ±z yenilendi âœ§</p>
        
        {% if not user.is_premium %}
        <div class="premium-alert">
            <div class="alert-icon">â­</div>
            <div class="alert-content">
                <h4>Premium'a GeÃ§</h4>
                <p>SÄ±nÄ±rsÄ±z fal hakkÄ± ve Ã¶zel Ã¶zelliklere eriÅŸim kazanÄ±n!</p>
                <a href="/premium" class="cosmic-button">Premium'a GeÃ§</a>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="dashboard-grid">
        <div class="dashboard-card fortune-card">
            <h3>GÃ¼nlÃ¼k Fal HaklarÄ±nÄ±z</h3>
            <div class="readings-grid">
                <div class="reading-stat">
                    <div class="reading-icon">â˜•</div>
                    <h4>Kahve FalÄ±</h4>
                    <div class="reading-count">{{ user.get_remaining_readings().coffee if not user.is_premium else "âˆ" }}</div>
                </div>
                
                <div class="reading-stat">
                    <div class="reading-icon">ğŸ´</div>
                    <h4>Tarot</h4>
                    <div class="reading-count">{{ user.get_remaining_readings().tarot if not user.is_premium else "âˆ" }}</div>
                </div>
                
                <div class="reading-stat">
                    <div class="reading-icon">âœ‹</div>
                    <h4>El FalÄ±</h4>
                    <div class="reading-count">{{ user.get_remaining_readings().palm if not user.is_premium else "âˆ" }}</div>
                </div>
                
                <div class="reading-stat">
                    <div class="reading-icon">â­</div>
                    <h4>BurÃ§ Yorumu</h4>
                    <div class="reading-count">{{ user.get_remaining_readings().zodiac if not user.is_premium else "âˆ" }}</div>
                </div>
                
                <div class="reading-stat">
                    <div class="reading-icon">ğŸ’­</div>
                    <h4>RÃ¼ya Tabiri</h4>
                    <div class="reading-count">{{ user.get_remaining_readings().dream if not user.is_premium else "âˆ" }}</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-card fortune-card">
            <h3>Son FallarÄ±nÄ±z</h3>
            <div class="readings-history">
                {% if user.readings_history %}
                    {% for reading in user.readings_history[-5:] %}
                    <div class="history-item">
                        <div class="reading-type">{{ reading.type }}</div>
                        <div class="reading-date">{{ reading.date.strftime('%d.%m.%Y %H:%M') }}</div>
                        <a href="#" class="cosmic-button small">Detaylar</a>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-history">
                        <p>HenÃ¼z fal baktÄ±rmamÄ±ÅŸsÄ±nÄ±z</p>
                        <a href="/coffee-fortune" class="cosmic-button">Ä°lk FalÄ±nÄ±zÄ± BakÄ±n</a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="dashboard-card fortune-card">
            <h3>Profil Bilgileri</h3>
            <form class="profile-form" id="profile-form">
                <div class="form-group">
                    <label for="birth_date">DoÄŸum Tarihi</label>
                    <input type="date" id="birth_date" name="birth_date" value="{{ user.profile.birth_date or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="zodiac_sign">BurÃ§</label>
                    <select id="zodiac_sign" name="zodiac_sign">
                        <option value="">SeÃ§iniz</option>
                        <option value="â™ˆ" {% if user.profile.zodiac_sign == "â™ˆ" %}selected{% endif %}>KoÃ§</option>
                        <option value="â™‰" {% if user.profile.zodiac_sign == "â™‰" %}selected{% endif %}>BoÄŸa</option>
                        <option value="â™Š" {% if user.profile.zodiac_sign == "â™Š" %}selected{% endif %}>Ä°kizler</option>
                        <option value="â™‹" {% if user.profile.zodiac_sign == "â™‹" %}selected{% endif %}>YengeÃ§</option>
                        <option value="â™Œ" {% if user.profile.zodiac_sign == "â™Œ" %}selected{% endif %}>Aslan</option>
                        <option value="â™" {% if user.profile.zodiac_sign == "â™" %}selected{% endif %}>BaÅŸak</option>
                        <option value="â™" {% if user.profile.zodiac_sign == "â™" %}selected{% endif %}>Terazi</option>
                        <option value="â™" {% if user.profile.zodiac_sign == "â™" %}selected{% endif %}>Akrep</option>
                        <option value="â™" {% if user.profile.zodiac_sign == "â™" %}selected{% endif %}>Yay</option>
                        <option value="â™‘" {% if user.profile.zodiac_sign == "â™‘" %}selected{% endif %}>OÄŸlak</option>
                        <option value="â™’" {% if user.profile.zodiac_sign == "â™’" %}selected{% endif %}>Kova</option>
                        <option value="â™“" {% if user.profile.zodiac_sign == "â™“" %}selected{% endif %}>BalÄ±k</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="favorite_reading">Favori Fal TÃ¼rÃ¼</label>
                    <select id="favorite_reading" name="favorite_reading">
                        <option value="">SeÃ§iniz</option>
                        <option value="coffee" {% if user.profile.favorite_reading == "coffee" %}selected{% endif %}>Kahve FalÄ±</option>
                        <option value="tarot" {% if user.profile.favorite_reading == "tarot" %}selected{% endif %}>Tarot</option>
                        <option value="palm" {% if user.profile.favorite_reading == "palm" %}selected{% endif %}>El FalÄ±</option>
                        <option value="zodiac" {% if user.profile.favorite_reading == "zodiac" %}selected{% endif %}>BurÃ§ Yorumu</option>
                        <option value="dream" {% if user.profile.favorite_reading == "dream" %}selected{% endif %}>RÃ¼ya Tabiri</option>
                    </select>
                </div>
                
                <button type="submit" class="cosmic-button">Profili GÃ¼ncelle</button>
            </form>
        </div>
        
        {% if user.is_premium %}
        <div class="dashboard-card fortune-card premium-status">
            <h3>Premium Ãœyelik</h3>
            <div class="premium-info">
                <div class="premium-icon">ğŸ‘‘</div>
                <div class="premium-details">
                    <p>Premium Ã¼yeliÄŸiniz: <strong>{{ user.premium_until.strftime('%d.%m.%Y') }}</strong> tarihine kadar aktif</p>
                    <a href="/premium" class="cosmic-button">ÃœyeliÄŸi Uzat</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('profile-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch('/api/profile/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            const result = await response.json();
            showNotification('Profil baÅŸarÄ±yla gÃ¼ncellendi', 'success');
        } else {
            const error = await response.json();
            showNotification(error.error || 'Profil gÃ¼ncellenirken bir hata oluÅŸtu', 'error');
        }
    } catch (error) {
        showNotification('Bir hata oluÅŸtu', 'error');
    }
});

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>
{% endblock %} 